{% extends 'layouts/two-pane.html' %}

{% load custom_tags %}

{% block back_link %}
    {% if not form_pk or form_pk == 0 %}
		{% if page.back_link.url != '#' or page.back_link.text != 'Back' %}
			{% if page.back_link.text %}
	    		<a href="{{ page.back_link.url }}" id="back-link" class="govuk-back-link">{{ page.back_link.text }}</a>
			{% endif %}
		{% else %}
			{{ block.super }}
		{% endif %}
    {% else %}
		<form method="post">
			{% csrf_token %}
			{% hidden_field 'form_pk' form_pk %}
			{% for key, value in data.items %}
				{% hidden_field key value %}
			{% endfor %}
			<button class="lite-back-link-button" role="link" id="back-link" type="submit" name="_action" value="back" action="back">{{ page.back_link.text }}</button>
		</form>
	{% endif %}
{% endblock %}

{% block two_thirds %}

	<!-- Error Summary -->
	{% if errors %}
		<div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="error-summary">
			<h2 class="govuk-error-summary__title" id="error-summary-title">
				There are errors on this page
			</h2>
			<div class="govuk-error-summary__body">
				<ul class="govuk-list govuk-error-summary__list">
					{% for key, value in errors.items %}
						<li>
							<a href="#{{ key }}">
								{% for error in value %}
									{{ error }}
								{% endfor %}
							</a>
						</li>
					{% endfor %}
				</ul>
			</div>
		</div>
	{% endif %}

	{% if page.caption %}
		<span class="govuk-caption-xl">{{ page.caption }}</span>
	{% endif %}

	<legend class="govuk-fieldset__legend govuk-fieldset__legend--xl">
		<h1 class="govuk-fieldset__heading">
			{{ page.title }}
		</h1>
	</legend>

	{% if page.description %}
		<span class="govuk-hint" style="display: block; margin: 30px 0;">
			{{ page.description|linebreaksbr }}
		</span>
	{% endif %}

	<!-- Questions -->
	<form {% if page.post_url %}action="{{ page.post_url }}"{% endif %} method="post" enctype="multipart/form-data">
		{% csrf_token %}

		{% for question in page.questions %}
			{% if question.input_type == "html_block"  %}
				{{ question.html|safe }}
			{% elif question.input_type == "detail"  %}
				{% include "components/details.html" with title=question.title description=question.description %}
			{% elif question.input_type == "heading" %}
				{% include "components/heading.html" with text=question.text %}
			{% else %}
				{% if question.input_type == "side_by_side" %}
					<div class="lite-side-by-side-wrapper">
						{% for question in question.questions %}
							{% include "components.html" with question=question errors=errors %}
						{% endfor %}
					</div>
				{% elif question.input_type == "group" %}
					<div id="pane_{{ question.name }}" class="{% for class in question.classes %}{{ class }} {% endfor %}">
						{% for question in question.components %}
							{% include "components.html" with question=question errors=errors %}
						{% endfor %}
					</div>
				{% else %}
					{% include "components.html" with question=question errors=errors %}
				{% endif %}
		{% endif %}
	{% endfor %}

	<!-- Buttons -->
	<div class="govuk-form-group">
		<div class="lite-buttons-row">
			{% for button in page.buttons %}
				{% if button.link %}
					<a href="{{ button.link }}" role="button" draggable="false" data-module="govuk-button" class="{{ button.style }}" {% if button.float_right %}style="float: right;"{% endif %}>{{ button.value }}</a>
				{% else %}
					<button type="submit" name="_action" value="submit" class="{{ button.style }}"
						{% if button.float_right %}style="float: right;"{% endif %}
						{% if button.disable_double_click %}
							data-module="govuk-button"
							data-prevent-double-click="true"
						{% endif %}
						action="submit">{{ button.value }}</button>
				{% endif %}
			{% endfor %}
		</div>

        <!-- Footer Label -->
		{% if page.footer_label %}
			<p class="govuk-body">{{ page.footer_label.text|safe }}</p>
		{% endif %}
	</div>

</form>

<script nonce="{{ request.csp_nonce }}" type="text/javascript">
	function showHidePanels() {
		$('input:radio').each(function () {
            var $this = $(this)
            var show_pane = $this.attr('show_pane')
            $('#' + show_pane).addClass('govuk-inset-text')
            if (show_pane) {
                if ($this.is(':checked')) {
                    $('#' + show_pane).show()
                } else {
                    $('#' + show_pane).hide()
                }
            }
		});
	}

	showHidePanels();

	$("input:radio").on("change", function() {
		showHidePanels()
	});
</script>

{% endblock %}
{% block one_third %}
	{% for question in page.helpers %}
		<aside class="lite-related-items" role="complementary">
			<h2 class="govuk-heading-m" id="subsection-title">
				{{ question.title }}
			</h2>
			<p class="govuk-body">
				{{ question.description }}
			</p>
		</aside>
	{% endfor %}

	{% for url in page.javascript_imports %}
		<script src="{{ url }}"></script>
	{% endfor %}
{% endblock %}
