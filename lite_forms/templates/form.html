{% extends 'layouts/two_pane.html' %}

{% load custom_tags %}

{% block back_link %}
	{% if page.back_link %}
        {% if page.back_link.url != '#' or page.back_link.text != 'Back' %}
		    <a href="{{ page.back_link.url }}" class="govuk-back-link {% if persistent_bar.text %}lite-persistent-bar--back{% endif %}">{{ page.back_link.text }}</a>
        {% else %}
            {{ block.super }}
        {% endif %}
    {% endif %}
{% endblock %}

{% block two_thirds %}

	<!-- Error Summary -->
	{% if errors %}
		<div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="error-summary">
			<h2 class="govuk-error-summary__title" id="error-summary-title">
				There are errors on this page
			</h2>
			<div class="govuk-error-summary__body">
				<ul class="govuk-list govuk-error-summary__list">
					{% for key, value in errors.items %}
						<li>
							<a href="#{{ key }}">
								{% for error in value %}
									{{ error }}
								{% endfor %}
							</a>
						</li>
					{% endfor %}
				</ul>
			</div>
		</div>
	{% endif %}

	<!-- Page header and description -->
	{% if page.caption %}
		<span class="govuk-caption-l">{{ page.caption }}</span>
	{% endif %}
		<h2 class="govuk-heading-l">{{ page.title }}</h2>
		<div class="govuk-form-group">
			<p class="govuk-caption-m">
				{{ page.description|linebreaksbr }}
			</p>
		</div>

		<!-- Questions -->
		<form {% if page.post_url %}action="{{ page.post_url }}"{% endif %} method="post" enctype="multipart/form-data">
			{% csrf_token %}

			{% for question in page.questions %}
				{% if question.input_type == "html_block"  %}
					{{ question.html|safe }}
				{% elif question.input_type == "detail"  %}
					{% include "components/details.html" with title=question.title description=question.description %}
				{% elif question.input_type == "heading" %}
					{% include "components/heading.html" with text=question.text %}
				{% else %}
					{% if question.input_type == "side_by_side" %}
						<div class="lite-side-by-side-wrapper">
							{% for question in question.questions %}
								{% include "components.html" with question=question errors=errors %}
							{% endfor %}
						</div>
					{% elif question.input_type == "group" %}
						<div id="pane_{{ question.name }}">
							{% for question in question.components %}
								{% include "components.html" with question=question errors=errors %}
							{% endfor %}
						</div>
					{% else %}
						{% include "components.html" with question=question errors=errors %}
					{% endif %}
			{% endif %}
		{% endfor %}

		<!-- Buttons -->
		<div class="govuk-form-group">
			<div class="lite-buttons-row">
				{% for button in page.buttons %}
					{% if button.link %}
						<a href="{{ button.link }}" role="button" draggable="false" data-module="govuk-button" class="{{ button.style.value }}" {% if button.float_right %}style="float: right;"{% endif %}>{{ button.value }}</a>
					{% else %}
						<button type="submit" class="{{ button.style }}" {% if button.float_right %}style="float: right;"{% endif %} action="submit">{{ button.value }}</button>
					{% endif %}
				{% endfor %}
			</div>
		</div>
	</form>

	<script type="text/javascript">
		function showHidePanels() {
			$('input:radio').each(function () {
                var $this = $(this)
                var show_pane = $this.attr('show_pane')
                $('#' + show_pane).addClass('govuk-inset-text')
                if (show_pane) {
                    if ($this.is(':checked')) {
                        $('#' + show_pane).show()
                    } else {
                        $('#' + show_pane).hide()
                    }
                }
			});
		}

		showHidePanels();

		$("input:radio").on("change", function() {
			showHidePanels()
		});
	</script>

{% endblock %}
{% block one_third %}
	{% for question in page.helpers %}
		<aside class="lite-related-items" role="complementary">
			<h2 class="govuk-heading-m" id="subsection-title">
				{{ question.title }}
			</h2>
			<p class="govuk-body">
				{{ question.description }}
			</p>
		</aside>
	{% endfor %}

	{% for url in page.javascript_imports %}
		<script src="{{ url }}"></script>
	{% endfor %}
{% endblock %}
